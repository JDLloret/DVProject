---
title: "Home Assignment: Exploratory analysis and visualization"
output: html_document
date: "2025-05-15"
author: "Joan Lloret and Martí Díez"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Load libraries

```{r libraries}
library(ggplot2)
library(ggfortify)
library(factoextra)
library(stats)
library(Rtsne)
library(dplyr)
library(tidyr)
library(patchwork)
library(gridExtra)
```

# QUESTION 1: Load, adapt the data and create metadata
# Load the data files

```{r data}
rep1 <- read.csv("./data/rep1.csv")
rep2 <- read.csv("./data/rep2.csv")
rep3 <- read.csv("./data/rep3.csv")
rep4 <- read.csv("./data/rep4.csv")
```

# Check the dimensions of the data, fix rows and transpose the matrix to ensure the data is properly displayed

```{r}
rows <- nrow(rep1)
columns <- ncol(rep1)
cat("The data set rep1 has", rows, "rows and", columns, "columns.\n")

rows <- nrow(rep2)
columns <- ncol(rep2)
cat("The data set rep2 has", rows, "rows and", columns, "columns.\n")

rows <- nrow(rep3)
columns <- ncol(rep3)
cat("The data set rep3 has", rows, "rows and", columns, "columns.\n")

rows <- nrow(rep4)
columns <- ncol(rep4)
cat("The data set rep4 has", rows, "rows and", columns, "columns.\n")


rownames(rep1) <- rep1$X
rep1$X <- NULL

rownames(rep2) <- rep2$X
rep2$X <- NULL

rownames(rep3) <- rep3$X
rep3$X <- NULL

rownames(rep4) <- rep4$X
rep4$X <- NULL

all_equal <- all(rownames(rep1) == rownames(rep2)) &&
             all(rownames(rep1) == rownames(rep3)) &&
             all(rownames(rep1) == rownames(rep4))
cat("Gene name order identical across datasets:", all_equal, "\n")


rep1 <- t(rep1)
rep2 <- t(rep2)
rep3 <- t(rep3)
rep4 <- t(rep4)

```

# Create the metadata and bind the datasets for posterior analysis

```{r}
replicate <- rep(c("1", "2", "3", "4"), each = nrow(rep1))

A_B_vector <- rep(c("A", "B"), each = nrow(rep1) / 2)

metadata <- data.frame(replicate, A_B_vector)

data <- rbind(rep1, rep2, rep3, rep4)
```



# QUESTION 2: PCA representation
There are three types of PCA representations:
Unscaled, Scaled and Normalized. The unscaled representation uses raw data and can lead to an uneven representation since it can emphasize genes with higher overall expression.
The scaled representation scales and centers the data and highlights changes across conditions.
The normalized representation adjusts for the total expression. This means that each sample has a similar total expression level. This representation is used when we compare samples where the total expression might vary a lot. 
```{r}
set.seed(123)

# UNSCALED PCA
pca_unscaled <- prcomp(data, scale = FALSE)
names(pca_unscaled)

# SCALED PCA
pca_scaled <- prcomp(data, scale = TRUE)
names(pca_scaled)

# NORMALIZE THE DATA
sum_data <- rowSums(data)
normalized_data <- sweep(data, 1, sum_data, "/")

# NORMALIZED PCA
pca_normalized <- prcomp(normalized_data, scale = TRUE)
```


# Plot the PCA representations

# Unscaled PCA plot
```{r}
pca1_unscaled <- fviz_pca_ind(pca_unscaled,
                              geom.ind = "point",
                              habillage = metadata$A_B_vector,
                              addEllipses = TRUE,
                              title = "A/B experiment")

pca2_unscaled <- fviz_pca_ind(pca_unscaled,
                              geom.ind = "point",
                              habillage = metadata$replicate,
                              addEllipses = TRUE,
                              title = "Replicates")


pca1_unscaled + pca2_unscaled + plot_annotation("Unscaled plots")
```

















